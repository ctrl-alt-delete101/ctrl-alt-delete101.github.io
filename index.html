<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analysis Oil Price with respect to Macroeconomic Factors</title>
    <style>
        body {
            font-family: sans-serif;
            line-height: 1.6;
            margin: 20px;
            background-color: #f4f4f4;
            color: #333;
        }
        .container {
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        h1, h2, h3 {
            color: #2c3e50;
        }
        h1 {
            text-align: center;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }
        h2 {
            border-bottom: 1px solid #ddd;
            padding-bottom: 5px;
            margin-top: 30px;
        }
        .project-info {
            text-align: center;
            margin-bottom: 20px;
            font-style: italic;
        }
        .collaborators {
            margin-bottom: 20px;
        }
        .collaborators h3 {
            margin-bottom: 5px;
        }
        .collaborators ul {
            list-style-type: none;
            padding-left: 0;
        }
        .collaborators li {
            margin-bottom: 5px;
        }
        .plot-placeholder {
            text-align: center;
            padding: 20px;
            border: 1px dashed #ccc;
            margin: 20px 0;
            background-color: #f9f9f9;
        }
        .plot-placeholder img {
            max-width: 100%;
            height: auto;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #ecf0f1;
        }
        .code {
            background-color: #eee;
            padding: 2px 4px;
            border-radius: 3px;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Analysis Oil Price with respect to Macroeconomic Factors</h1>
        <p class="project-info">Spring 2025 Data Science Project - CMSC 320</p>

        <div class="collaborators">
            <h3>Collaborators:</h3>
            <ul>
                <li>Eric Chen</li>
            </ul>
            <h3>Contributions:</h3>
            <ul>
                <li><strong>Eric Chen:</strong> A, B, D, E. Worked on training/designing the elastic net model and its visualization, correlation matrix visualization, and scraped/cleaned the data.</li>
                <li><strong>Arjun Mudda:</strong> B, C, F, G. Explored and analyzed the correlation data for all of the macroeconomic factors vs Oil.</li>
                <li><strong>Alexander Rauch:</strong> C, F, G, E. Visualized the data for Oil vs US Bonds, Oil vs Alternative Oil, and Oil vs US Dollar. Performed the validation and R<sup>2</sup> tests on the elastic net model.</li>
            </ul>
        </div>

        <h2>1. Introduction</h2>
        <p>Crude oil is one of the most critical commodities globally, influencing everything from transportation costs and industrial production to inflation rates and geopolitical stability. The price of oil, particularly benchmarks like West Texas Intermediate (WTI), is notoriously volatile, affected by a complex interplay of supply, demand, economic health, and investor sentiment. Understanding the factors that drive oil prices is crucial for policymakers, businesses, investors, and consumers alike.</p>
        <p>This project aims to explore the relationship between WTI crude oil prices and a set of key macroeconomic factors. Specifically, we seek to answer the following questions:</p>
        <ul>
            <li>Which macroeconomic factors exhibit the strongest correlation (positive or negative) with WTI crude oil prices?</li>
            <li>Can we build a predictive model using these macroeconomic factors to forecast oil price movements with reasonable accuracy?</li>
            <li>What insights can be gleaned from these relationships about the broader economic landscape?</li>
        </ul>
        <p>Answering these questions is important because accurate oil price forecasting can aid in economic planning, risk management for businesses, and investment strategies. Furthermore, identifying strong correlations can deepen our understanding of how different facets of the global economy are interconnected. This tutorial will walk through the data science pipeline, from acquiring and cleaning relevant financial data to performing exploratory analysis, building a machine learning model, and interpreting the results.</p>

        <h2>2. Data Curation</h2>
        <h3>Data Sources:</h3>
        <p>The analysis utilizes daily price data for WTI Crude Oil and eight key macroeconomic factors spanning several years (implicitly starting around 1991 based on the notebook's plot labels, up to recent data). The datasets used are:</p>
        <ul>
            <li><strong>Crude Oil (WTI):</strong> Target variable (<span class="code">oil_data.csv</span>)</li>
            <li><strong>US 10-Year Treasury Bonds:</strong> Represents interest rates/safe-haven demand (<span class="code">bond.csv</span>)</li>
            <li><strong>US Dollar Index (DXY):</strong> Represents the strength of the US dollar (<span class="code">dollar_data.csv</span>)</li>
            <li><strong>Euro (EUR/USD):</strong> Represents the strength of a major competing currency (<span class="code">eur_data.csv</span>)</li>
            <li><strong>Exxon Mobil Stock (XOM):</strong> Proxy for shale/alternative oil production and major oil company performance (<span class="code">exxon.csv</span>)</li>
            <li><strong>Gold Prices:</strong> Represents a traditional safe-haven asset and inflation hedge (<span class="code">gold_data.csv</span>)</li>
            <li><strong>Japanese Yen (JPY/USD):</strong> Represents another major global currency (<span class="code">japan_data.csv</span>)</li>
            <li><strong>Natural Gas Prices:</strong> Represents a related energy commodity (<span class="code">natural_gas_data.csv</span>)</li>
            <li><strong>S&P 500 (SPY):</strong> Represents the overall health of the US economy/stock market (<span class="code">spy.csv</span>)</li>
        </ul>
        <p>While the specific source URLs are not listed in the notebook, this type of daily financial data is commonly obtained from sources like Yahoo Finance, FRED (Federal Reserve Economic Data), financial data APIs (like Alpha Vantage, used in imports), or financial data providers (like Investing.com, implied by some raw data formats).</p>

        <h3>Data Preprocessing and Transformation:</h3>
        <p>A significant challenge with combining time-series data from different financial markets is ensuring proper alignment. Different assets trade on different schedules, and markets close for weekends and holidays, leading to non-overlapping dates in the raw datasets. To prepare the data for analysis, the following steps were performed (as detailed in the Jupyter Notebook):</p>
        <ul>
            <li><strong>Loading Data:</strong> Each raw CSV file was loaded into a pandas DataFrame.</li>
            <li><strong>Column Selection:</strong> Only 'Date' and 'Price' (or equivalent closing price) columns were typically retained.</li>
            <li><strong>Date Conversion:</strong> The 'Date' column in each DataFrame was converted to the datetime format.</li>
            <li><strong>Sorting:</strong> DataFrames were sorted chronologically by date.</li>
            <li><strong>Timestamp Alignment:</strong> The core preprocessing step involved aligning all macroeconomic factor datasets to the dates present in the WTI Crude Oil dataset. This was achieved using <span class="code">pandas.merge_asof</span> with <span class="code">direction='forward'</span>. This method merges datasets based on the nearest preceding date, effectively forward-filling values for factors on days when oil traded but the factor did not (e.g., weekends for stocks/bonds).</li>
            <li><strong>Handling Missing Values:</strong> After the initial merge, gaps could still exist if a factor had no preceding data point close enough. To create a complete dataset for modeling, missing values (NaNs) introduced during alignment were filled using time-series interpolation (<span class="code">interpolate(method='time')</span>). This method estimates missing values based on the time intervals between existing data points, which is suitable for daily financial data.</li>
            <li><strong>Data Cleaning:</strong> Price data containing commas (e.g., Gold prices) were cleaned by removing the commas before converting to numeric types.</li>
            <li><strong>Final Concatenation:</strong> The preprocessed, aligned, and interpolated price columns for oil and the eight factors were concatenated into a single DataFrame (<span class="code">merged_data</span>) used for the subsequent analysis.</li>
        </ul>
        <p>The resulting DataFrame contains daily price data where each row represents a trading day for WTI oil, and the corresponding columns contain the oil price and the aligned/interpolated prices of the eight macroeconomic factors for that same day.</p>

        <h2>3. Exploratory Data Analysis</h2>
        <p>Before building a predictive model, we explored the relationships between WTI oil prices and the selected macroeconomic factors using correlation analysis and visualization.</p>
        <h3>Methods:</h3>
        <ul>
            <li><strong>Pearson Correlation:</strong> Used to measure the linear relationship between oil and factors assumed to have a potentially linear association (e.g., Bonds, Exxon).</li>
            <li><strong>Spearman Correlation:</strong> Used to measure the monotonic relationship (how well the relationship can be described using a monotonic function) between oil and factors where the relationship might not be strictly linear (e.g., US Dollar).</li>
            <li><strong>Correlation Matrix & Heatmap:</strong> Used to visualize the pairwise correlations between all variables simultaneously.</li>
        </ul>
        <h3>Findings & Visualizations:</h3>
        <h4>Oil vs. US Bonds:</h4>
        <ul>
            <li>Pearson correlation coefficient: -0.599</li>
            <li>P-value: 0.0</li>
            <li><strong>Conclusion:</strong> There is a statistically significant, moderate negative linear correlation between WTI oil prices and US 10-Year Treasury Bond prices (or yields, depending on how 'Price' was defined in the raw data - the plot suggests yields given the scale). As oil prices tend to go up, bond prices/yields tend to go down, and vice versa. This might reflect a flight-to-safety effect where rising oil prices (potentially indicating inflation or instability) drive investors towards bonds, lowering yields (or vice-versa).</li>
        </ul>
        <div class="plot-placeholder">
            <p><em>(Insert Oil vs Bonds Scatter Plot here)</em></p>
            </div>

        <h4>Oil vs. US Dollar:</h4>
        <ul>
            <li>Spearman correlation coefficient: -0.417</li>
            <li>P-value: 0.0</li>
            <li><strong>Conclusion:</strong> There is a statistically significant, moderate negative monotonic correlation between WTI oil prices and the US Dollar Index. Generally, a stronger dollar tends to correspond with lower oil prices (as oil is globally priced in USD), and a weaker dollar with higher oil prices.</li>
        </ul>
        <div class="plot-placeholder">
            <p><em>(Insert Oil vs Dollar Scatter Plot here)</em></p>
            </div>

        <h4>Oil vs. Alternative Oil (Exxon):</h4>
        <ul>
            <li>Pearson correlation coefficient: 0.837</li>
            <li>P-value: 0.0</li>
            <li><strong>Conclusion:</strong> There is a statistically significant, strong positive linear correlation between WTI oil prices and Exxon Mobil's stock price. This suggests that the performance of major oil producers, including those involved in alternative/shale oil, is closely tied to the price of crude oil.</li>
        </ul>
        <div class="plot-placeholder">
            <p><em>(Insert Oil vs Exxon Scatter Plot here)</em></p>
            </div>

        <h4>Overall Correlation Matrix:</h4>
        <p>The heatmap visualization provides a comprehensive overview of all pairwise correlations.</p>
        <p><strong>Key Observations (Top Row vs. Oil):</strong></p>
        <ul>
            <li>Strongest Positive: Exxon (+0.84), Gold (+0.72)</li>
            <li>Moderate Positive: SPY (+0.58), Natural Gas (+0.48)</li>
            <li>Weak/Near Zero: Euro (+0.06), Yen (-0.10)</li>
            <li>Moderate Negative: US Dollar (-0.46)</li>
            <li>Strongest Negative: US Bonds (-0.60)</li>
        </ul>
        <div class="plot-placeholder">
            <p><em>(Insert Full Heatmap and Top-Row Heatmap here)</em></p>
            </div>
        <p>These exploratory findings confirm expected relationships (like Oil/Exxon, Oil/Dollar) and reveal others (like the strong negative Oil/Bond correlation and positive Oil/Gold correlation), providing a foundation for building a predictive model.</p>

        <h2>4. Primary Analysis</h2>
        <p>Based on the exploratory analysis showing significant correlations between oil prices and several macroeconomic factors, we chose to build a regression model to predict WTI oil prices using these factors as features.</p>
        <h3>Machine Learning Technique: Elastic Net Regression</h3>
        <p>We selected Elastic Net regression for our primary analysis. Elastic Net is a penalized linear regression model that combines the penalties of Lasso (L1) and Ridge (L2) regression.</p>
        <h4>Reasoning:</h4>
        <ul>
            <li><strong>Handles Multicollinearity:</strong> Financial and macroeconomic variables often exhibit multicollinearity (correlation among predictors). Elastic Net's Ridge component helps to mitigate the issues caused by this.</li>
            <li><strong>Feature Selection:</strong> The Lasso component can shrink the coefficients of less important features towards zero, effectively performing feature selection, which can be useful even with a moderate number of features (8 in our case).</li>
            <li><strong>Balance:</strong> It provides a balance between Lasso (which can sometimes arbitrarily select one feature from a group of correlated features) and Ridge (which tends to shrink coefficients of correlated features together).</li>
        </ul>
        <h4>Implementation:</h4>
        <ul>
            <li><strong>Feature/Target Split:</strong> The <span class="code">merged_data</span> DataFrame was split into features (X: the 8 macroeconomic factors) and the target variable (y: WTI Oil price).</li>
            <li><strong>Train-Test Split:</strong> The data was split into a training set (80%) and a testing set (20%) using <span class="code">train_test_split</span> with <span class="code">random_state=42</span> for reproducibility. While a simple random split isn't ideal for time series, it provides a baseline evaluation. Time Series Cross-Validation was used later for a more robust assessment.</li>
            <li><strong>Feature Scaling:</strong> Features were standardized using <span class="code">StandardScaler</span>. This is crucial for penalized regression models like Elastic Net, as it ensures all features contribute equally to the penalty term, preventing features with larger scales from dominating. The scaler was fit only on the training data and then used to transform both training and testing data to avoid data leakage.</li>
            <li><strong>Model Training:</strong> An <span class="code">ElasticNet</span> model was instantiated (<span class="code">alpha=0.1</span>, <span class="code">l1_ratio=0.7</span> - these hyperparameters control the overall penalty strength and the mix between L1/L2) and trained on the scaled training data (<span class="code">elastic_net.fit(X_train_scaled, y_train)</span>).</li>
            <li><strong>Prediction:</strong> The trained model was used to predict oil prices on the scaled test set (<span class="code">y_pred = elastic_net.predict(X_test_scaled)</span>).</li>
        </ul>
        <h4>Evaluation:</h4>
        <h5>Initial Train-Test Split:</h5>
        <ul>
            <li>Mean Squared Error (MSE): 87.71</li>
            <li>R-squared (R<sup>2</sup>): 0.900</li>
        </ul>
        <p><strong>Interpretation:</strong> The R<sup>2</sup> value of 0.90 indicates that the model, using the 8 macroeconomic factors, can explain approximately 90% of the variance in WTI oil prices on the held-out test set. This suggests a strong predictive capability based on this initial split. The MSE gives a measure of the average squared difference between predicted and actual prices.</p>

        <h5>Time Series Cross-Validation (TSCV):</h5>
        <p>To get a more reliable estimate of the model's performance over time, 5-fold time series cross-validation was performed using <span class="code">TimeSeriesSplit</span>. This method ensures that the training set always precedes the test set in each fold, respecting the temporal nature of the data.</p>
        <p>Results across 5 folds:</p>
        <ul>
            <li>MSE: [34.36, 81.43, 132.04, 156.22, 98.90]</li>
            <li>R-squared: [0.04, 0.69, 0.65, 0.72, 0.76] (Rounded for clarity)</li>
        </ul>
        <p><strong>Interpretation:</strong> The TSCV results show more variability. While some folds achieve good R<sup>2</sup> scores (up to 0.76), the first fold has a very low R<sup>2</sup> (0.04), indicating poor performance on that specific early time slice. The MSE also varies significantly. This suggests that while the model has potential, its performance might not be consistently high across all time periods, possibly due to changing market dynamics, overfitting on certain periods, or the influence of factors not included in the model. The average R<sup>2</sup> across the folds is lower than the initial 0.90, giving a more conservative estimate of the model's generalizability.</p>

        <h2>5. Visualization</h2>
        <p>To visualize the performance of the Elastic Net model, we plotted the predicted oil prices against the actual WTI oil prices for the test set period. The test set predictions were sorted chronologically before plotting.</p>
        <div class="plot-placeholder">
            <p><em>(Insert Real vs Predicted Plot here)</em></p>
            </div>
        <h4>Plot Explanation:</h4>
        <p>The plot displays the actual daily WTI oil prices (blue line) over the entire dataset period and overlays the predicted prices from the Elastic Net model on the test set portion (red line).</p>
        <p>Visually, the predicted prices (red) generally track the trends and movements of the actual prices (blue) quite well during the test period, capturing major upswings and downswings. This aligns with the high initial R-squared value.</p>
        <p>However, there are periods where the predictions deviate more significantly, potentially reflecting the variability seen in the time series cross-validation results.</p>
        <p>The model appears to capture the overall magnitude and direction of price changes but may lag slightly or miss the exact peaks and troughs.</p>
        <p>Notably, the plot shows the extreme event in April 2020 where WTI prices went negative. While the test set might not fully cover this period depending on the split, linear models like Elastic Net typically struggle to predict such unprecedented black swan events accurately, as they are trained on historical patterns that don't include such extremes. The predictions would likely not go negative or capture the depth of that specific crash.</p>

        <h2>6. Insights and Conclusions</h2>
        <p>This analysis explored the relationship between WTI crude oil prices and eight key macroeconomic factors, culminating in the development of an Elastic Net regression model for price prediction.</p>
        <h3>Key Findings:</h3>
        <ul>
            <li><strong>Strong Correlations Exist:</strong> Exploratory data analysis confirmed significant correlations. WTI oil prices show a strong positive linear correlation with Exxon Mobil stock (proxy for alternative/shale oil, r &asymp; 0.84) and Gold (r &asymp; 0.72). Strong negative linear correlation was observed with US Bonds (r &asymp; -0.60), and a moderate negative monotonic correlation with the US Dollar Index (r &asymp; -0.42). Factors like the Euro showed minimal linear correlation.</li>
            <li><strong>Predictive Model Performance:</strong> The Elastic Net regression model demonstrated strong initial predictive power on a standard train-test split, explaining about 90% of the variance in oil prices (R<sup>2</sup> &asymp; 0.90).</li>
            <li><strong>Time-Dependent Variability:</strong> Time series cross-validation revealed that the model's performance varies across different time periods (R<sup>2</sup> ranging from 0.04 to 0.76). This highlights the challenges of modeling financial time series, where relationships can shift, and suggests the model might be more reliable during certain market regimes than others.</li>
        </ul>
        <h3>Answering Introduction Questions:</h3>
        <ul>
            <li>The factors most strongly correlated with oil prices were Exxon stock (positive), Gold (positive), US Bonds (negative), and the US Dollar (negative).</li>
            <li>A predictive model using these factors achieved high initial accuracy (R<sup>2</sup>=0.90), but its robustness over time is less consistent, as shown by TSCV. It can provide reasonable forecasts but should be used with caution, especially during periods of high volatility or structural market changes.</li>
            <li>The correlations provide economic insights: the link between crude and producer stocks (Exxon), the inverse relationship with the US dollar (commodity pricing), the potential role of oil/bonds in reflecting risk sentiment or inflation expectations, and the connection to gold as an inflation/uncertainty hedge.</li>
        </ul>
        <h3>Limitations:</h3>
        <ul>
            <li><strong>Interpolation:</strong> Filling missing data via interpolation, while necessary, might have smoothed the data or introduced minor inaccuracies.</li>
            <li><strong>Model Simplicity:</strong> Elastic Net is a linear model and may not capture complex non-linear relationships or time-dependent dynamics inherent in financial markets.</li>
            <li><strong>Feature Scope:</strong> The model only includes eight factors. Other crucial elements like geopolitical events, OPEC decisions, inventory levels, weather patterns, and shifts in energy policy were not explicitly included and can significantly impact oil prices.</li>
            <li><strong>Extreme Events:</strong> The model is unlikely to predict extreme, unprecedented events like the negative prices seen in April 2020.</li>
        </ul>
        <h3>Conclusions:</h3>
        <p>Macroeconomic factors hold significant explanatory power for WTI crude oil price movements. Factors related to alternative energy production (Exxon), safe-haven assets (Gold, Bonds), and currency strength (USD) show notable correlations. While a linear model like Elastic Net can capture a large portion of the historical price variance, its predictive reliability fluctuates over time. This underscores the complexity of the oil market and suggests that while macroeconomic factors are important drivers, other dynamic elements and unforeseen events also play critical roles. For more robust forecasting, incorporating more diverse data sources and potentially employing time-series specific models (like ARIMA or LSTMs) could be beneficial future work.</p>
    </div>
</body>
</html>